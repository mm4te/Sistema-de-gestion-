<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inventario</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="layout">
    <div class="sidebar">
      <h2><span>Comenda Deco</span></h2>
      <a href="/"><span>ğŸ“Š Inicio</span></a>
      <a href="/inventario" class="active"><span>ğŸ“¦ Inventario</span></a>
      <a href="/ventas"><span>ğŸ›’ Ventas</span></a>
      <a href="/clientes"><span>ğŸ‘¥ Clientes</span></a>
      <a href="/ventas_historial"><span>ğŸ“ˆ Ventas Hist.</span></a>
      <a href="/reporte/excel"><span>ğŸ“¥ Reporte</span></a>
      <a href="/logout" style="margin-top: auto; color: #e63946;"><span>ğŸšª Cerrar sesiÃ³n</span></a>
    </div>

    <div class="main-content">
      <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-messages">
              {% for category, message in messages %}
                <p class="{{ category }}">{{ message }}</p>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
          <h1>ğŸ“¦ Inventario ({{ total }} productos)</h1>
          <div>
            <a href="/cargar_excel" class="btn-secondary">ğŸ“¤ Cargar Excel</a>
            <a href="/nuevo_producto" class="btn-primary">â• Nuevo Producto</a>
          </div>
        </div>

        <!-- Formulario de filtros -->
        <form method="get" style="background: white; padding: 20px; border-radius: 12px; margin: 20px 0; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end;">
            <div>
              <label for="q">ğŸ” Buscar:</label>
              <input type="text" id="q" name="q" value="{{ search_query }}" placeholder="CÃ³digo o descripciÃ³n...">
            </div>
            <div>
              <label for="stock">Filtrar por stock:</label>
              <select id="stock" name="stock">
                <option value="">Todos los productos</option>
                <option value="sin_stock" {% if filtro_stock == 'sin_stock' %}selected{% endif %}>Sin stock</option>
              </select>
            </div>
            <div>
              <label for="orden">Ordenar por:</label>
              <select id="orden" name="orden">
                <option value="">Sin ordenar</option>
                <option value="mayor" {% if orden == 'mayor' %}selected{% endif %}>Precio: mayor a menor</option>
                <option value="menor" {% if orden == 'menor' %}selected{% endif %}>Precio: menor a mayor</option>
                <option value="nuevo" {% if orden == 'nuevo' %}selected{% endif %}>MÃ¡s nuevo primero</option>
                <option value="viejo" {% if orden == 'viejo' %}selected{% endif %}>MÃ¡s antiguo primero</option>
              </select>
            </div>
            <div>
              <button type="submit" style="width: 100%;">Aplicar filtros</button>
            </div>
          </div>
          {% if search_query or filtro_stock or orden %}
            <div style="margin-top: 15px;">
              <a href="{{ url_for('inventario.inventario') }}" style="color: #e63946; text-decoration: none;">â†º Limpiar filtros</a>
            </div>
          {% endif %}
        </form>

        <!-- Importar desde Tienda Nube -->
        <form method="post" action="/cargar_tiendanube" enctype="multipart/form-data" style="margin-bottom: 20px;">
          <label class="file-upload">
            ğŸ“¤ Importar desde Tienda Nube
            <input type="file" name="file" accept=".csv" required>
          </label>
          <button type="submit" style="margin-left: 10px;">Cargar</button>
        </form>

        <!-- Tabla de productos -->
        {% if productos %}
          <div class="table-responsive">
            <table>
              <thead>
                <tr>
                  <th>CÃ³digo</th>
                  <th>DescripciÃ³n</th>
                  <th>Precio</th>
                  <th>Stock</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                {% for p in productos %}
                  <tr>
                    <td data-label="CÃ³digo">{{ p[1] }}</td>
                    <td data-label="DescripciÃ³n">{{ p[2] }}</td>
                    <td data-label="Precio">$ {{ p[3] | pesos }}</td>
                    <td data-label="Stock">{{ p[4] }}</td>
                    <td data-label="Acciones">
                      <a href="/editar_producto/{{ p[0] }}" style="margin-right: 10px;">âœï¸ Editar</a>
                      <a href="/eliminar_producto/{{ p[0] }}" onclick="return confirm('Â¿Eliminar este producto?')" style="color: #e63946;">ğŸ—‘ï¸ Eliminar</a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- PaginaciÃ³n -->
          {% if total_pages > 1 %}
            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
              {% if page > 1 %}
                <a href="{{ url_for('inventario.inventario', page=page-1, q=search_query, stock=filtro_stock, orden=orden) }}" class="pagination-link">Â« Anterior</a>
              {% endif %}
              {% for p in range(1, total_pages+1) %}
                {% if p == page %}
                  <span style="background: var(--primary); color: white; padding: 6px 12px; border-radius: 6px; font-weight: bold;">{{ p }}</span>
                {% else %}
                  <a href="{{ url_for('inventario.inventario', page=p, q=search_query, stock=filtro_stock, orden=orden) }}" class="pagination-link">{{ p }}</a>
                {% endif %}
              {% endfor %}
              {% if page < total_pages %}
                <a href="{{ url_for('inventario.inventario', page=page+1, q=search_query, stock=filtro_stock, orden=orden) }}" class="pagination-link">Siguiente Â»</a>
              {% endif %}
            </div>
          {% endif %}
        {% else %}
          <p>No se encontraron productos.</p>
        {% endif %}
      </main>
    </div>
  </div>
</body>
</html>